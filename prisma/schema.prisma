generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  technician
  client
}

enum TicketStatus {
  open
  in_progress
  closed
}

model User {
  id String @id @default(uuid())
  name String
  email String @unique
  password String
  role Role @default(client)
  isActive Boolean @default(true)
  profileImage String?
  availability String[] @default([])

  ticketsAsClient Ticket[] @relation("ClientTickets")
  ticketsAsTechnician Ticket[] @relation("TechnicianTickets")
  ticketServicesAdded TicketService[] @relation("UserAddedServices")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")
  @@map("users")
}

model Service {
  id String @id @default(uuid())
  name String
  description String?
  price Float
  isActive Boolean @default(true)
  tickets TicketService[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")
  @@map("services")
}

model Ticket {
  id String @id @default(uuid())
  title String
  description String
  status TicketStatus @default(open)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")

  clientId String
  client User @relation("ClientTickets", fields: [clientId], references: [id], onDelete: Cascade)
  technicianId String?
  technician User? @relation("TechnicianTickets", fields: [technicianId], references: [id])
  services TicketService[]
  @@map("tickets")
}

model TicketService {
  id String @id @default(uuid())
  ticketId String
  serviceId String
  addedById String
  createdAt DateTime @default(now()) @map("created_at")

  ticket Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id])
  addedBy User @relation("UserAddedServices", fields: [addedById], references: [id])
  @@map("ticket_service")
}